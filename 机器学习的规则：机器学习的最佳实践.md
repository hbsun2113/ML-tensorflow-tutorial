https://developers.google.com/machine-learning/rules-of-ml/
#机器学习的规则：机器学习工程的最佳实践
这篇文档的目的在于帮助那些掌握了机器学习基础知识的人群能够在Google的机器学习最佳实践中享受到益处。它与Google的C++风格指南或其他受欢迎的指南相似，代表了机器学习的一种风格。如果你上过机器学习的课程，或者曾经构建或者在某一机器学习模型上工作过，那么你有足够的背景阅读这篇文章。

##术语
下面的名字将会在我们关于有效机器学习的的讨论中频繁出现：

1. 实例(Instance):你将要对其进行预测的事物。例如，一个示例可能是一个网页，你想将其分类为“是关于猫的”或“不是关于猫的”。
2. 标签(Label)：针对预测任务的答案。要么是机器学习系统所产生的答案，要么是训练数据给出的真实答案。例如，一个网页的标签可能是“是关于猫的”。
3. 特征(Feature):用于预测任务中的实例的属性。例如，一个网页可能包含的特征是“包含‘猫’这个词”。
4. 特征列(Feature Column)：一系列相关特征的集合，例如是用户可能居住的国家的集合。一个例子在特征列中可能包含一个或多个特征。“特征列”是Google指定的专用术语。一个特征列就如同虚拟系统中的命名空间，或是域。
5. 例子(Example):一个实例，包含了特征和标签。
6. 模型(Model)：关于预测任务的统计表示。你在许多例子上对模型进行训练，然后利用模型进行预测。
7. 度量标准(Metric)：一项你很关心的指标。可能被直接或间接优化。
8. 目标(Object)：一个特殊的度量标准，是你的算法尝试优化的度量标准。
9. 管道(Pipeline)：围绕机器学习算法的一系列配套措施。包含从头到尾地收集数据，将其放进训练数据的文件中，训练一个或多个模型，并将模型用于生产。
10. 点击率(Click-through Rate):网站访问者点击进入广告的比率。

##概述
做出伟大的产品：

**做机器学习，如同你是一个伟大的工程师，而不是你是一个伟大的机器学习专家。**

大多数你面对的问题都会是工程问题。即使拥有一个伟大的机器学习专家所具备的资源，绝大多数的收益都会是好的特征，而不是好的机器学习算法。所以，基本的方法是：

  1. 确保你的管道是端到端牢固的。
  2. 建立一个合乎情理的目标。
  3. 使用简单的方法，添加具有普遍共识的、常识性的特征们。
  4. 确保你的管道仍旧是牢固的。

这方法将会在很长的时间都很有效。只有你不再拥有可以使你走得更远的简单技巧的时候，你才需要从这种方法中脱离出来。增加复杂性会减缓未来的推进速度。

一旦你厌烦了简单的技巧，最为尖端的机器学习技术可能才是你的未来。请看章节三机器学习项目。

文档将会按照如下进行安排：

  1. 第一部分将会帮助你理解是否是正确的时间用于构建机器学习系统。
  2. 第二部分是关于构建你的第一个管道。
  3. 第三部分是在向管道中添加新特征时的启动和迭代，如何评估模型和训练偏差。
  4. 第四部分是讲，当你到达瓶颈时该如何去做。
  5. 然后，会列举出一些相关工作和附录，它们是关于本系统中常用系统举例的背景知识。

##在机器学习系统之前
规则 #1：不必在启动一个产品的时候担心没有机器学习。

机器学习很酷，但是它需要数据。理论上，你可以从不同的问题上获得数据，然后调整模型用于一个新的产品上，但它可能比基本的启发式方法还要差。如果你认为机器学习会给你100%的提升，那么启发式方法会给你50%的提升。

例如，如果你的app商店里对app进行排名，你可以使用安装率或者安装的数量作为启发式方法。如果你在检测垃圾邮件，你可以过滤掉曾经发送过垃圾邮件的发送者。不要担心使用人工编辑。如果你需要对联系人进行排名，请按照使用频率进行排序(或者甚至使用字母序进行排列)。如果机器学习方法不能完全符合你的产品需要，请不要使用它直到你拥有了数据。

规则 #2:首先，设计和实现度量标准

在正式确定你的机器学习系统要做什么之前，请尽可能多地跟踪你的当前系统。之所以这样做是因为一下几个原因：

   1. 早期获得系统用户的许可更加容易。
   2. 如果你认为一些事情将来可能造成问题，那么最好的方法是现在就获得历史数据。
   3. 如果你在设计系统时考虑到了度量标准的，很多事情在将来可能会变得容易。特殊地，你不会想在日志里查找字符串用来获得度量标准的数据。
   4. 你将注意到什么事情改变了，什么事情没有发生改动。例如，假设你想要优化系统的日均活动用户。然而，在你对系统的早期操控中，你会发现用户体验的显著变化并没有改变这一项指标。

Google Plus团队会测量每次阅读的扩展，每次阅读的分享，每次阅读的评论，每个用户的评论，每个用户的分享，等等，这些用于计算发帖时间的好处。另外，注意到实验框架是很重要的，你可以通过实验将用户进行分组，然后集成起来用于统计。详见 规则 #12。

通过更加活跃地添加指标，你可以对你的系统更加熟悉。注意到一个问题？添加一个指标用来跟踪它！对上一版本的量化变化感兴趣？添加一个指标跟踪它！

规则 #3：在复杂的启发式基础上选择机器学习

一个简单的启发式方法可能会让你的产品走出门外。一套复杂的启发式方法是不容易维护的。一旦你有了数据和基本的想法去赴之实现。请转移到机器学习的方法中去。正如绝大多数的软件工程任务一样，你将想要持续地更新你的方法，到底选择启发式方法还是机器学习方法呢？你将会发现机器学习方法更容易维护和更新(请见规则 #16)。

##机器学习阶段：你的第一个管道流水线

关注你第一条流水线的系统结构。尽管你对利用机器学习做事情非常感兴趣，但是如果你不信任你的流水线，将很难说明会发生什么。

规则 #4:保证你的第一个模型非常简单，并且保证你的流水线结构是正确的

你的第一个模型对你的产品将会产生最大的推动力，所以它不必一定要非常绚丽。但是你一定会遇到比你预料多得多的问题。在任何人使用你的绚丽的机器学习系统之前，你一定要确定的是：

  1. 如何为你的机器学习算法获得例子。
  2. 首先要确定对于你的系统来说什么是好什么是坏
  3. 如何把你的模型集成到你的系统中去。你要么保证模型可以在线使用，要么先用例子离线计算出模型，然后把结果存储到一张表格中去。例如，你可能想要首先将网页进行分类，然后把结果存储到一张表格中，但你又可能想要实时地对聊天消息进行分类。

选择简单的特征，并确保很容易保证：
  
  1. 这些特征可以使你的模型算法正确
  2. 模型可以学习到合理的权重
  3. 特征可以使你的模型在服务端保证正确
  
一旦你把上述三种事情做得可靠，你其实就已经完成了大部分的工作。你的简易模型可以提供给你非常基础的评价指标，并提供基础的功能使你去测试更加复杂的模型。一些团队旨在确保第一次的发布使是中立的，第一次的发布明确优先考虑机器学习的收益，这样可以确保不分心。

规则 #5：独立于机器学习，对你的基础架构进行测试

确保你的基础架构是可以测试的，并且确保系统的学习部分是封装好的，这样你可以测试它周围的一切。特别地：

   1. 测试即将输入到算法中的数据。检查应该被填充的列是否已经被填充。如果隐私许可，手工检查你的输入数据。如果可以，请检查你管道的统计信息，如果其他地方也对这批数据进行了检查，请将这两个统计信息进行对比。
   2. 在训练算法之外对你的模型进行检查。确保你的模型在训练环境中和使用环境中具有同样的性能。

机器学习具有很多的不确定因素，所以对于在训练环境和使用环境中产生例子的代码，你一定要进行检查。并且，在使用期间，你可以加载并且使用一些固定的模型。另外，对于理解你的数据也很重要：请看[对于分析大型复杂数据的一些实践建议](http://www.unofficialgoogledatascience.com/2016/10/practical-advice-for-analysis-of-large.html)

规则 #6在复制管道的时候，要仔细地对待被丢弃的数据

当我们在创建一个新的管道的时候，可能要复制已存在的管道，此时旧的管道可能将一些数据进行丢弃，虽然这些旧数据可能仍然对新的管道有用。例如，Google Plus的管道What's Hot丢弃了旧的推文(因为它在尝试将新的推文进行排序)。这个管道被复制用来当作Google Plus的流，虽然旧的推文仍然具有意义，但是这个管道仍然将旧推文进行了丢弃。另一个比较通用的模式是只记录能被用户看到的数据。因此，当我们建模想要弄清楚为什么一个特定的推文没有被用户看到，所有的数据都是无用的，因为负样本已经全部被我们丢弃了。在Play商场，同样的问题也发生过。在Play Apps的主页上工作的时候，一条新的管道被创建，它包含了许多来自Play Game的登陆页上的例子，但是没有任何特征可以用来辨别这些例子来源于何处。

规则7 将启发式规则转化成特征，或者在外部处理它们，然后放入系统中

通常机器学习所需要处理的问题不是一个完全新的问题。比如之前会有系统对网页进行排名 、对邮件进行分类等等其他你需要处理的问题。如果将这些之前的方法融入进你的机器学习系统中，可能会带来提升。无论这些方法包含了什么样的信息，你都需要对它们进行额外的关注，主要原因有两个方面。首先，这会使得转化成为机器学习问题的过程变得平滑顺利。第二，这些方法包含的直观思路是你不想丢弃的。一下有四种方法可以将已存在的启发式规则融入进机器学习系统。

  1. 利用启发式规则进行预处理。如果某个特征具有非凡的效果，那么这种方法是一个不错的选项。例如，在垃圾邮件的过滤当中，如果发送者已经被记录到黑名单中了，那么请不要尝试重新去学习“黑名单”的含义，请屏蔽这些信息。这样的方法在二分类问题中最为有效。
  2. 直接创建一个特征。如果可以直接将启发式规则转化成特征，那么这是很棒的。如果你可以通过规则直接计算出一个相关的分数，你可以直接把这些分数作为特征。进而，你可以使用机器学习方法将这些值进行转化(例如，将它们转化为一群有限的离散值或者将它们和其他特征值进行结合)，但请用启发式方法产生这些原始值。
  3. 挖掘启发式规则的输入的潜能。例如，有一个规则是联合了一些值：app安装的次数、文本中出现的字符数、一周当中的有效天数。请考虑将这些值进行分开，并且把它们分别输入到学习系统中。另外，一些适合组合的方法在这里(请看规则 #40)。
  4. 修改标签。如果你觉得启发式方法捕获的信息没有包含到标签中时，这将是一个改进的方法。例如，你正在尝试最大化下载量，同时也期待考虑内容的质量。解决的方法就是将标签乘上每个app受到的平均star数目。这里有很多方法，请参见“你的第一个目标”。

请考虑融入启发式方法的复杂度。使用原有的启发式方法可能会使得老系统转化为机器学习系统的过程顺利平滑，但同时也请思考是否有更简单的方法是先同样的效果呢。

##监控
通常来讲，我们需要一个良好的警报系统，并且这些警报可以灵活定制化，并有一个可供操作的界面。

你的模型如果一天没有更新，性能会下降多少？一周没有更新呢？一个季度没有更新呢？这个信息可以帮助你了解监控的优先级。如果模型一天没有更新，性能就下降了很多，那么你就需要专人去持续地进行监控了。大多数广告推介系统每天都需要处理新的广告，因此需要每天进行更新。例如，Google Play的模型如果一个月没有更新，那么就会产生很大的负面效应。而对于Google Plus来说，在他的模型中没有帖子的标识符，因此没有必要对模型进行频繁的更新。另外请注意新鲜度可能随时间变化，特别是向模型中加入特征列或者去除特征列的时候。



